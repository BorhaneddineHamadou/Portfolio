<!DOCTYPE html>
<html>
 <header>
     <title>My First Flask Web Page</title>

     <style>
         .hidden{
             display: none;
         }
     </style>
 </header>
 <body id="bod">
    <form id="add_form">
        <span style="font-size:20px">name : </span><input type="text" name="name" placeholder="Enter your name" id="name">
        &nbsp<input type="submit" value="ADD" style="padding:5px 10px;background-color:rgb(19, 110, 110);color:blanchedalmond;cursor: pointer;">
    </form>
    <span style="color:crimson; font-weight: bold;" id="error" class="hidden">Something Went Wrong !</span>
     {% for i in infos %}
       <h1>{{i.person_id}} - Hello, I am {{i.name}}  	<span style="color: blue;cursor: pointer;" class="delete" data-id='{{i.person_id}}'>&#8855;</span> </h1> 
     {% endfor %}
     <script>
        document.getElementById('add_form').onsubmit = function(e){
           e.preventDefault();
           fetch('/add_person',{
               method : 'POST',
               body : JSON.stringify({
                   'name':document.getElementById('name').value
               }),
               headers : {
                   'Content-Type' : 'application/json'
               }
           }).then(function(response){
               return response.json()
           }).then(function(jsonResponse){
               const H1ELEMENT = document.createElement('H1');
               H1ELEMENT.innerHTML = jsonResponse['person_id'] + ' - Hello, I am ' + jsonResponse['name'] + '    ';
               const SPANELEMENT = document.createElement('SPAN');
               SPANELEMENT.innerHTML = '&#8855;';
               SPANELEMENT.setAttribute('style', "color: blue;cursor: pointer;");
               H1ELEMENT.appendChild(SPANELEMENT);

               document.getElementById('bod').appendChild(H1ELEMENT);
               console.log(jsonResponse)
           }).catch(function(){
               document.getElementById('error').classList.remove('hidden');
           }) 
        }


        const DELETE = document.querySelectorAll('.delete');
        for(let i=0; i<DELETE.length;i++){
            DELETE[i].onclick = function(e){
               fetch('/delete/'+e.target.dataset.id, {
                   method : 'DELETE',
                   headers : {
                       'Content-Type' : 'application/json'
                   }
               }).then(function(){
                   DELETE[i].parentNode.remove()
               }).catch(function(){
                   document.getElementById('error').classList.remove('hidden')
               })
            }
        } 
     </script>
 </body>
</html>